<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Text-to-SQL Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="page">
      <header>
        <h1>Natural Language â†’ SQL Dashboard</h1>
        <p>Ask a question, pick a dataset, and inspect the generated SQL plus results.</p>
      </header>
      <section class="card">
        <form method="post" action="/query" class="form">
          <label for="question">Natural language question</label>
          <textarea
            id="question"
            name="question"
            rows="3"
            placeholder="e.g. Show each client and the division responsible for deals closed in 2024-Q3"
          >{{ question_value }}</textarea>

          <label for="schema_name">Dataset</label>
          <select id="schema_name" name="schema_name">
            <option value="">Auto (first schema)</option>
            {% for schema in schemas %}
            <option value="{{ schema }}" {% if schema == selected_schema %}selected{% endif %}>
              {{ schema | capitalize }}
            </option>
            {% endfor %}
          </select>

          <button type="submit">Run Query</button>
        </form>
      </section>

      {% if sql_text or error %}
      <section class="card">
        <h2>Generated SQL</h2>
        {% if sql_text %}
        <pre class="sql">{{ sql_text }}</pre>
        {% else %}
        <p class="muted">No SQL generated.</p>
        {% endif %}

        {% if error %}
        <div class="alert">{{ error }}</div>
        {% endif %}
      </section>
      {% endif %}

      {% if rows %}
      <section class="card">
        <h2>Result Rows</h2>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                {% for col in columns %}
                <th>{{ col }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in rows %}
              <tr>
                {% for cell in row %}
                <td>{{ cell }}</td>
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
      {% elif sql_text and not error %}
      <section class="card">
        <h2>Result Rows</h2>
        <p class="muted">Query executed but returned no rows.</p>
      </section>
      {% endif %}
    </div>
  </body>
</html>

